<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>REEL-4 Receptive and Expressive</title>
    <style>
        body {
            background-color: linen;
        }

        #inputAreaLeft {
            margin: 0 0 15px 0;
        }

        .container {
            margin: 5px 0;
            line-height: 25px;
        }

        h2 {
            margin: 8px 0 0 0;
        }

        .h2_receptive {
            color: black;
        }

        .h2_expressive {
            color: blue;
        }

        .rb-title {
            font-family: monospace;
            font-size: 14px;
            padding: 0 0px 0 7px;
        }

        .rb-label {
            padding: 0 0 0 10px;
        }

        .createReportButton {
            font-family: sans-serif;
            font-size: 14px;
            color: white;
            padding: 6px;
            border: 0px solid blue;
            border-radius: 5px;
            background-color: #875f9a;
            outline: none;
        }

        #leftColumn {
            float: left;
            width: 550px;
        }

        #rightColumn {
            float: left;
            width: 550px;
        }

        .bulletPointOutput {
            font-size: 10pt;
            font-family: "Calibri", serif;
            border: 5px solid #ccc;
            border-radius: 5px;
            outline: none;
            margin-top: 5px;
            background-color: #debaba;
            width: 90%;
        }
    </style>
</head>
<body>
    <div id="leftColumn">
        <div id="inputAreaLeft"></div>

        <div class="container">
            <button class="createReportButton" id="createReport-left">Create language RECEPTIVE bullet points from current selection</button><br>
            <div class="bulletPointOutput" id="bulletPointOutput-receptive"></div>
        </div>
    </div>

    <div id="rightColumn">
        <div id="inputAreaRight"></div>

        <div class="container">
            <button class="createReportButton" id="createReport-right">Create language EXPRESSIVE bullet points from current selection</button><br>
            <div class="bulletPointOutput" id="bulletPointOutput-expressive"></div>
        </div>
    </div>

    <script>
    var ageGroupLabels = [
        "0-6 Months",
        "7-12 Months",
        "13-22 Months",
        "23-27 Months",
        "28-36 Months"
    ];

    var textItems = {
        receptive: [
            { group: 0, index: 1,  itemText: "Briefly responds to a loud noise by blinking eyes or jerking whole body, and returns to normal appearance" },
            { group: 0, index: 2,  itemText: "Is quieted by a familiar voice when fussy" },
            { group: 0, index: 3,  itemText: "Stops moving when hearing unusual sounds" },
            { group: 0, index: 4,  itemText: "Looks toward the speaker" },
            { group: 0, index: 5,  itemText: "Looks toward new sounds or voices" },
            { group: 0, index: 6,  itemText: "Looks directly at speaker's face" },
            { group: 0, index: 7,  itemText: "Turns head and eyes toward a speaker" },
            { group: 0, index: 8,  itemText: "Looks at a nearby speaker when not directly spoken to" },
            { group: 0, index: 9,  itemText: "Stops crying when hearing a comforting voice" },
            { group: 0, index: 10, itemText: "Looks towards a speaker and smiles" },
            { group: 0, index: 11, itemText: "Becomes disturbed when hearing an angry voice" },
            { group: 0, index: 12, itemText: "Looks specifically at the speaker's mouth and lips" },
            { group: 0, index: 13, itemText: "Looks around and tries to find the person who is speaking" },
            { group: 0, index: 14, itemText: "Locates where a voice is coming from" },

            { group: 1, index: 15, itemText: "Responds to own name" },
            { group: 1, index: 16, itemText: "Exhibits different responses to different tones of voice" },
            { group: 1, index: 17, itemText: "Listens with interest when hearing music" },
            { group: 1, index: 18, itemText: "Stops regularly when hearing own name during play" },
            { group: 1, index: 19, itemText: "Understand meaning of \"daddy,\" \"mama,\" or \"bye-bye\"" },
            { group: 1, index: 20, itemText: "Responds to \"no\" or \"stop that\" half of the time" },
            { group: 1, index: 21, itemText: "Stops own action and listens to conversations between people" },
            { group: 1, index: 22, itemText: "Understands \"up\" or \"bye\" and gesture in answer" },
            { group: 1, index: 23, itemText: "Responds to \"no\" or \"stop that\" almost every time" },
            { group: 1, index: 24, itemText: "Listens when someone is talking without being distracted" },
            { group: 1, index: 25, itemText: "Reacts to the name of a family member who is not present" },
            { group: 1, index: 26, itemText: "Enjoys hearing names of familiar objects" },
            { group: 1, index: 27, itemText: "Moves to music's beat" },
            { group: 1, index: 28, itemText: "Looks at familiar objects when mentioned" },

            { group: 2, index: 29, itemText: "Responds to commands such as \"let's go\" or \"come here\"" },

            { group: 3, index: 38, itemText: "Enjoys listening to nursery rhymes, finger plays, or songs" },

            { group: 4, index: 43, itemText: "Follows two-step commands" },
        ],

        expressive: [
            { group: 0, index: 1,  itemText: "Makes sounds other than crying" },

            { group: 1, index: 15, itemText: "Babbles or chatters playfully" },

            { group: 2, index: 29, itemText: "Reacts to songs by trying to sing along" },

            { group: 3, index: 38, itemText: "Imitates environmental noises or animal sounds" },

            { group: 4, index: 43, itemText: "Repeats some of the words from sentences" },
        ]
    };

    // generates html elements in accordance to textItems
    (function() {

        // helper function to add title to div
        var addTitleDiv = function(parentDiv) {

            var divElem;
            var spanP;
            var spanM;
            var spanU;

            divElem = document.createElement("div");
            spanP = document.createElement("span");
            spanM = document.createElement("span");
            spanU = document.createElement("span");

            spanP.setAttribute("class", "rb-title");
            spanM.setAttribute("class", "rb-title");
            spanU.setAttribute("class", "rb-title");

            spanP.textContent = "+";
            spanM.textContent = "-";
            spanU.textContent = "untested";

            divElem.appendChild(spanP);
            divElem.appendChild(spanM);
            divElem.appendChild(spanU);

            parentDiv.appendChild(divElem);
        };

        // helper function to add radio button to div
        var addRadioButton = function(rbTextItem, rbIndex, parentDiv, typeValue) {

            var curName;
            var newDiv;
            var rbP, rbM, rbU;
            var spanElem;

            newDiv = document.createElement("div");
            rbP = document.createElement("input");
            rbM = document.createElement("input");
            rbU = document.createElement("input");
            spanElem = document.createElement("span");

            curName = "rb_"+typeValue+rbIndex;

            rbP.setAttribute("type", "radio");
            rbP.setAttribute("name", curName);
            rbP.setAttribute("value", "plus");

            rbM.setAttribute("type", "radio");
            rbM.setAttribute("name", curName);
            rbM.setAttribute("value", "minus");

            rbU.setAttribute("type", "radio");
            rbU.setAttribute("name", curName);
            rbU.setAttribute("value", "untested");
            rbU.setAttribute("checked", "checked");

            spanElem.setAttribute("class", "rb-label");
            spanElem.textContent = textItems[ typeValue ][ rbIndex ].index + ". " + textItems[ typeValue ][ rbIndex ].itemText;

            // add created elements to document
            newDiv.appendChild(rbP);
            newDiv.appendChild(rbM);
            newDiv.appendChild(rbU);
            newDiv.appendChild(spanElem);

            parentDiv.appendChild(newDiv);
        };

        // helper function to build input elements
        var buildInputPage = function(parentDiv, typeValue) {

            var curSubdiv;
            var curAgeGroup = -1;

            textItems[ typeValue ].forEach( function(rbTextItem,rbIndex) {

                if (rbTextItem.group !== curAgeGroup) {
                    // new age group

                    // complete previous group unless prev group is -1
                    if (curAgeGroup !== -1) {
                        parentDiv.appendChild(curSubdiv);
                    }

                    // start new group
                    var h2Elem = document.createElement("h2");

                    curAgeGroup += 1;
                    h2Elem.setAttribute("class", "h2_"+typeValue);
                    h2Elem.textContent = ageGroupLabels[curAgeGroup]+": Language "+typeValue;

                    // append new age group
                    parentDiv.appendChild(h2Elem);

                    // create new div for radio buttons
                    curSubdiv = document.createElement("div");

                    // add + - title to new subdiv
                    addTitleDiv(curSubdiv);
                }

                // add new radio item to current
                addRadioButton(rbTextItem, rbIndex, curSubdiv, typeValue);
            } );

            parentDiv.appendChild(curSubdiv);
        };

        var inputDivLeft = document.getElementById("inputAreaLeft");
        var inputDivRight = document.getElementById("inputAreaRight");

        buildInputPage(inputDivLeft, "receptive");
        buildInputPage(inputDivRight, "expressive");
    })();


    // helper function to format output text appropriately
    var formatText = function(indexArray, type, typeValue) {
        var count = indexArray[ typeValue ].length;

        if (count === 0) {
            return "";
        }

        var sentenceSubjectText = "";
        var sentenceVerbsText = "";
        var verbFormIndex;

        if (type === "cannot") {
            sentenceSubjectText = "(unable to do in "+typeValue+"):";
            verbFormIndex = "cannot";
        }
        else {
            sentenceSubjectText = "(able to do in "+typeValue+"):";
            verbFormIndex = "can";
        }

        if (count === 1) {
            // only one item, no need to add "and"
            sentenceVerbsText = " "+textItems[ typeValue ][ indexArray[ typeValue ][0] ][ verbFormIndex ];
        }
        else {
            for (var i=0; i<count; i++) {
                if (i === count-1) {
                    // add and if last item in list
                    sentenceVerbsText += " and";
                }

                sentenceVerbsText += " "+textItems[ typeValue ][ indexArray[ typeValue ][i] ][ verbFormIndex ];

                if (i < count-2) {
                    // add comma if before second to last item in list 
                    sentenceVerbsText += ",";
                }
            }
        }

        // add full stop
        sentenceVerbsText += "."

        return sentenceSubjectText + sentenceVerbsText;
    };

    // update function for bulletpoint divs
    var UpdateBulletPointDivText = function(indexArrayArray, typeValue) {
        // grab bulletpoint div
        var bpDiv = document.getElementById( "bulletPointOutput-"+typeValue );
        if( !bpDiv ) { return; }

        // clear div
        bpDiv.innerHTML = "";

        const HEADER_TEXT = [
            "(able to do in ",
            "(unable to do in ",
        ];
        indexArrayArray.forEach( function( indexArray, indexArray_index ) {
            var headerDiv = document.createElement( "div" );
            headerDiv.classList.add( "div_bulletPointDivHeader" );
            headerDiv.appendChild( document.createTextNode( HEADER_TEXT[ indexArray_index ]+typeValue.toUpperCase()+"):" ) );
            bpDiv.appendChild( headerDiv );

            var count = indexArray[ typeValue ].length;

            if (count === 0) { return; }

            // create list object
            var listElem = document.createElement( "ul" );

            indexArray[ typeValue ].forEach( function( indexValue, index_index ) {
                var listItem = document.createElement( "li" );
                listItem.appendChild( document.createTextNode( textItems[ typeValue ][ indexValue ].itemText ) );
                listElem.appendChild( listItem );
            } );

            // list done, add to div
            bpDiv.appendChild( listElem );
        } );

        return;
    };

    // helper function to scan radio buttons
    var scanRadioButtons = function(typeValue, canIndexArray, cannotIndexArray) {
        var rbIndex = 0;

        while (true) {
            var curName = "rb_"+typeValue+rbIndex;
            curRadioButtonArray = document.getElementsByName(curName);
            var length = curRadioButtonArray.length;

            if (length === 0) break;

            var curVal;
            for (var i=0; i<length; i++) {
                if (curRadioButtonArray[i].checked) {
                    curVal = curRadioButtonArray[i].value;
                    break;
                }
            }

            if (curVal === "plus") {
                canIndexArray[ typeValue ].push(rbIndex);
            }
            else if (curVal === "minus") {
                cannotIndexArray[ typeValue ].push(rbIndex);
            }

            rbIndex++;
        }
    };

    // update report content inside textarea
    var updateReport = function(leftOrRight) {
        return function(event) {
            var text = "";
            var curRadioButton;

            var canIndexArray = { receptive: [], expressive: [] };
            var cannotIndexArray = { receptive: [], expressive: [] };

            // loop to scan selections and store results in index arrays
            if ( leftOrRight === 'left' ) {
                // only process receptive for left
                scanRadioButtons("receptive", canIndexArray, cannotIndexArray);
                UpdateBulletPointDivText( [ canIndexArray, cannotIndexArray ], "receptive");
            }
            else {
                // only process expressive for right
                scanRadioButtons("expressive", canIndexArray, cannotIndexArray);
                UpdateBulletPointDivText( [ canIndexArray, cannotIndexArray ], "expressive");
            }
        };
    };

    // select all text in textarea
//    var selectAllText = function(event) {
//        event.preventDefault();
//        setTimeout(function() { event.target.select(); }, 1); 
//    };

    var tempTypes = [ 'left', 'right' ];
    tempTypes.forEach( function( lOrR, index ) {
        goButton = document.getElementById( 'createReport-'+lOrR );
        goButton.addEventListener( 'click', updateReport( lOrR ) );
    } );

//    outputArea.addEventListener("focus", selectAllText);
    </script>
</body>
</html>
